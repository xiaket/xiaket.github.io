---
title:  "Pensieve: 2208"
date:   2022-08-27 15:24
ref:    pensieve-2208
---

### 所观所读所玩所听

某晚上无聊的时候重看了成龙的[尖峰时刻(rush hour)](https://www.netflix.com/watch/17236928), 烂片, 不叙. 另外看过的一个视频是[奇迹数独](https://www.youtube.com/watch?v=yKf9aUIxdb4), 一个数独板上只有1和2, 再加上比较严苛的数独规则, 最后能够推导出所有的数字. 这个视频很早之前看过, 最近翻自己twitter找东西时看到了, 趁开会之前快进看了一遍, 回头又自己解了一遍, 也有了更深入的体会. 这个谜题最好玩的地方是3的推导, 抽丝剥茧般的推理, 很漂亮.

手机上杀时间读[曾文正公家书](https://book.douban.com/subject/20365752/), 对比这个月读的另一本家书, 高下立判, 毕竟是能够拿到文正谥号的人. 目前进度10%左右, 前面絮絮叨叨地向祖父母汇报自己的衣食住行, 银钱往来, 后面开始给弟弟们写信了, 自如一些, 能够讲讲做人做事的道理了. 读这本也多少了解了清朝中后期的历史, 比如之前自己一直以为翰林和詹事这两个官职类似铁饭碗, 读这本书才知道至少清朝时这两个官职还是需要考试和评定级别的. 曾国藩参加的这次考试地点在圆明园, 而且考试的时候竟然还有人敢作弊, 结果被抓交由刑部治罪. 一百多人考试, 分四档, 第一档五名, 第二档55名, 第三档56名, 第四档7名. 文正公这次考试获得第六名, 算是很出彩的成绩了.

iPad上看完了一本数学书, 名字是[无解的方程](https://book.douban.com/subject/35522827/). 这本书的作者韩旭很是低调, 问了在数学系任教而且就是做这个方向的本科同学, 也打听不到仙踪所在. 不过书写得还是挺有意思, 基础概念讲完后, 开始讲形式逻辑, 然后讲代数结构(群, 环, 代数等), 再是方程和根的讨论, 最后得到结论: 五次方程没有求根公式. 实话实说, 这本书代数结构的部分我没有细看, 不仅不算走马观花, 有些地方甚至都未踏足. 不过整本书读下来还是对现代代数学有了一些更深入的概念. 另外看这本书也让我想起了之前读[初等几何的著名问题](https://book.douban.com/subject/1672958/), 高斯对正十七边形尺规作图的推导也是很绝妙.

说图书馆的书前先聊一下这个月主要玩的游戏, [地平线: 西之禁域](https://www.playstation.com/en-au/games/horizon-forbidden-west/). 目前接近50级, 主线任务还剩最后两个, 成就拿了一半左右, 拿到了两件传奇护甲, 一个传奇猎弓和一个传奇战士弓, 努力farm升级中. 印象最深的部分是某天晚上去拿波塞冬, 跳进水里, 藏在水草里面躲避burrower和鳄鱼的巡逻, 降低水阀, 最后打蛇颈龙boss, 很是过瘾. 之前玩零之曙光的时候是照着一个视频来无伤通关. 这次玩西之禁域的时候不会那么排斥近程肉搏, 反正就是满地打滚拉开一点空间后射箭嘛. 这个游戏的风景和Zelda有一拼了, 随便找个地方截屏都能拿来当桌面.

图书馆读完了三本半. 读完的是马伯庸的[两京十五日](https://book.douban.com/subject/35080870/), 李诞的[笑场](https://book.douban.com/subject/27113334/), 以及[于是之家书](https://book.douban.com/subject/27019530/), 那半本是余华的[四月三日事件](https://book.douban.com/subject/30142313/). 看完马伯庸那本感觉依然没什么新意, 画面感太强, 感觉是在看剧本. 笑场没什么特别的意思, 可以不读. 于是之家书有点意思, 和前面曾文正公家书一样, 相当多的絮絮叨叨, 不过对着那段历史来看, 有些部分还挺好玩. 比如按照当时领导们的要求, 演员要下基层积累实践经验, 才能写出那些主旋律的文化作品. 对这种填鸭式的管理方式不提, 倒是于是之当时去体验生活时去的是密云水库附近的一个村, 当时穷困得很. 现在那个村的房价已经有两万多一平米了. 又比如出国访问时也会在当地逛街买买东西, 看着他自己说也是看着别人买什么自己就买什么, 莞尔. 整本书没端架子, 有一说一, 虽然不像前面曾国藩家书那样有用, 但是多少也算可读. 最后那半本余华则是实在读不下去了, 先锋和实验性质太重, 疯子和傻子齐飞. 最让人受不了的那位用酷刑来折磨自己的文革被迫害人士, 我能明白这些故事是想表达什么, 但是我实在有点受不了这种自己对自己实施墨刑宫刑和凌迟的描述.

Apple Music里面加了不少专辑, 虽然听得不多:

  - 莫文蔚的两张爵士乐专辑[Love Jazz Vol. 1 EP](https://music.apple.com/cn/album/%E9%92%9F%E6%83%85%E7%88%B5%E5%A3%AB%E4%B9%90-vol-1-ep/1621115787?l=en)和[Vol2](https://music.apple.com/cn/album/loves-jazz-vol-2-ep/1623937413?l=en).
  - 两个游戏的OST, [地平线](https://music.apple.com/cn/album/horizon-forbidden-west-original-soundtrack/1615443972?l=en)和[对马岛](https://music.apple.com/cn/album/ghost-of-tsushima-music-from-iki-island-legends/1581649555?l=en).
  - Belle Chen的[Years of Pilgrimage](https://music.apple.com/cn/album/years-of-pilgrimage/1631139760?l=en)
  - 陈珊妮的[後來 我們都哭了](https://music.apple.com/cn/album/%E5%BE%8C%E4%BE%86-%E6%88%91%E5%80%91%E9%83%BD%E5%93%AD%E4%BA%86/1533959567?l=en), 为了里面那首情歌.
  - Sissel的[Reflections II](https://music.apple.com/cn/album/reflections-ii/1484903682?l=en)

### EC2启动问题一例

我们一个用来当作部署agent的ASG里面经常会启动大量的机器, 这些个机器有一定几率能起来但是不运行服务, 远程登陆不了, 也没办法查. 之前的同学可能是为了解决这个问题开了一个负载均衡器, 不接受来自外部的请求, 仅用来做健康检查. 反正大公司, 也不在乎一个负载均衡器的钱. 这一切本来也都还好. 直到有一天这个负载均衡器开始杀正常的机器了, 想想我们部署到了一半, 负载均衡器觉得这个机器有问题, 咔嚓一声用terminate-instance杀了, 被部署的服务不上不下, 还得我们来手工修复, 我们很是头大.

于是我有天运气不好, 单天处理了四五个agent被错误杀掉的案例, 终于受不了了, 开始调试这个问题. 首先, 关掉了负载均衡器, 等到某一台上重现了这个问题后, 关实例, 磁盘做snapshot后换机器挂载. 挂载了硬件后, LVM那块还小折腾了一会儿. 因为两块硬盘在LVM里UUID都是一样的, 还得用`vgimportclone`命令改一下名字, 挂载完成后好玩了. `/var/log`里面没数据.

查到这儿很是头大, 系统启动后没往`/var/log`里写东西? 所以这是systemd的锅? 无奈, 改AMI, 添加了一些内核参数, 将输出重定向到console, 再更新ASG, 再等着机器挂, 这次运气不错, 不需要挂载硬盘就能在系统日志里看到问题了:

```
[ESC[0;1;31mFAILEDESC[0m] Failed to mount /var/log.
See 'systemctl status var-log.mount' for details.
[ESC[0;1;33mDEPENDESC[0m] Dependency failed for Unattended Upgrades Shutdown.
[ESC[0;1;33mDEPENDESC[0m] Dependency failed for Flush Journal to Persistent Storage.
[ESC[0;1;33mDEPENDESC[0m] Dependency failed for Update UTMP about System Runlevel Changes.
[ESC[0;1;33mDEPENDESC[0m] Dependency failed for Update UTMP about System Boot/Shutdown.
[ESC[0;1;33mDEPENDESC[0m] Dependency failed for Local File Systems.

...

You are in emergency mode. After logging in, type "journalctl -xb" to view
system logs, "systemctl reboot" to reboot, "systemctl default" or "exit"
to boot into default mode.
Press Enter for maintenance
```

所以某一块盘挂载失败, 恰好是`/var/log`(所以写不了日志), 卡在那儿了, 而这个时候网络已经起来了, 所以AWS那边认为这台机器又是健康的, 所以没自动杀掉. 果断把这个问题扔给AWS support了, 目前还没下文. 如果AWS那边没有好的解决方案, 我们这儿也能用其他办法自己解决, 用不着负载均衡器这种妖路子解决方案.
