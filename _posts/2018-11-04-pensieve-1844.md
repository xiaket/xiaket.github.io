---
title:  "Pensieve: 1844"
date:   2018-11-04 22:21 +1100
lang:   zh
ref:    pensieve-1844
---

### 所观所读

手机上读田中英树的奔流, 实在读得尴尬了. 这日本腔放在一个中国历史背景下, 而且还不伦不类地扯到了梁祝.

在Netflix上看完了一个建LEGO之家的纪录片, 没什么特别的感触.

### 所玩

空洞骑士卡关了一两周, 终于过了叛逆领主. 用蜂巢提高容错率, 用两个加长攻击距离的护符来提高你和领主之间的距离, 耐心近身普通攻击, 刷白浪的时候用黑冲躲.

Darkest Dungeon尝试了一次final boss, 失败, 死了三个六级的人物. 决定还是先慢慢把所有建筑都建好然后再尝试. 另外, 已经又有不少人染上了血色诅咒, 还得再刷一次boss.

Diablo 3的NS版周五开始玩, 到现在PL170级, 愉快地刷T9刷远古. 总体来说这个port还挺好. 另外, Diablo有了手机版. reddit/youtube上差评成群, 看着一群人黑前东家, 感觉很复杂.

回头看, 这周游戏玩得挺多的.

### 用rdfind来找出重复文件

最近等树莓派到的时候就在整理自己的文件们. 我有三块外置硬盘, 一块是需要外部供电的桌面式硬盘, 大小1T, 准备接树莓派来做TimeMachine的备份. 一块大小4T, USB供电, 准备也直接接树莓派, 做媒体库. 另一块大小为2T的盘用来做冷备. 我先整理了下那些媒体文件, 用rsync来找重复文件, 然后去重, 删除.  万幸所有的文件都能放进4T的那块盘里面. 但是我其余的一群小文件例如照片/自摄视频和书籍们就分布得很散乱了. 有些文件会保存在多个文件夹里, 这样是不行的. 所以, 我的任务是在一个目录里根据文件内容来找出重复的文件并手工删除.

简单调研了一下, 找到了[rdfind](https://github.com/pauldreik/rdfind)这个工具, 除了命令行语法比较特里独行外, 没什么大的缺点了. 我用它处理了一个大小为1T的盘里的所有文件, 它给出了一个大小为23M, 有14万行内容的结果文件, 里面按文件大小排好了序. 我用grep就简单地过滤出了要删的文件们. 从这一点上来看, 这个命令真挺方便的. 虽说这个逻辑不难写, 但是用现成的工具会更放心一点.

### 新坑: 用Ansible来配置树莓派上的服务

坑在[这儿](https://github.com/xiaket/314)

先介绍下背景: 家里没有显示器(电视不算), 没有USB键盘. 网络都是通的, 无线路由上有有线网口.

这次折腾树莓派踩了不少坑, 整理如下:

1. 安装时没有sd卡读卡器, 万幸我妈的Windows笔记本上带了一个, 所以安装都是征用了她的电脑来完成的.
2. 安装后如何设置让树莓派连上网. 本来我自诩也算是一个Linux小高手, 直接上了raspbian, 网上找到的直接往根目录里写wpa配置的方法测试不可行. 安装好之后只能望着这个小主板叹气. 后来试用了给noob用的系统安装程序, 将树莓派接到电视, 另外外接了鼠标, 本希望一切能正常工作, 不过这个名为noob的安装程序竟然没有屏幕键盘, 我能看到屏幕上的输入框, 却不能往里面输wifi的密码. 最后解决的办法是回到raspbian, 安装好后设置好ssh, 直接有线网接到无线路由, 在无线路由的客户端列表里找到树莓派的ip后直接ssh连过去.
3. TimeMachine服务器. 这货水果家没开源, 现在只有逆向出来的仿照版. 安装好设置时踩了小坑, 也许是因为我某次关树莓派时没正常`init 0`, 所以一块本用来当TimeMachine存储的硬盘被mark成不干净, 需要fsck. 我用`mount -a`挂载的时候挂成了只读, 这个命令的标准错误写到了日志, 命令行下没提示. 所以我后面配置好`netatalk`服务后Mac里始终不认认为这块盘可以当TimeMachine备份盘, 所以它不会出现在TimeMachine备选磁盘列表里. 我当时猜测这个可能是因为网上找到的[文档](https://github.com/mr-bt/raspberrypi-timemachine)比较旧, 对于新的Mojave不奏效, 所以我在各种Mac系统配置里折腾了好久.
4. 最后这个是大坑, 我设置好TimeMachine服务后, 准备搞多媒体共享. 我用了[OpenMediaVault](http://www.openmediavault.org), 然后这货就导致我的ssh连接断掉了. 读了下文档, 似乎它默认还设置了ufw规则, 阻止各种网络连接, 于是我的树莓派又变成黑盒了. 这个问题没解决, 诅咒了写php的人一万遍以后格盘重装了.


这次重装后我意识到我后面可能还会需要重装一次系统, 于是这次是老老实实地用Ansible来管理所有配置. repo上面已经给过链接. 目前只是配置好系统, 挂载了两块硬盘, 开了NFS共享而已. 测试用一个客户端rsync + ssh上传, 另一个客户端播放NFS里的视频, 虽然上传速度一般, 但是媒体播放完全不卡, 这样够了.

后面除了TimeMachine备份服务器外, 还希望开一个图片管理软件, 目前看上了[photoprism](https://github.com/photoprism/photoprism), 缺点是它目前还不支持视频文件的管理. 后面再看看有没有其余的解决方案吧.

最后, 如果有时间还得加一个简单的监控日志, 回头也调研下有没有类似的东西.


### 链接

* [https://blog.natetodd.com/mount-linux-nfs-share-from-macos-10-13-high-sierra/](https://blog.natetodd.com/mount-linux-nfs-share-from-macos-10-13-high-sierra/) 我基本是看着这篇文档搞好了NFS服务. 另外, 这篇里面有一个漏洞是挂载时需要`-o resvport`参数, 这导致在Finder里面不能直接添加这个路径, 解决办法是服务器端挂载时额外加一个`insecure`参数, 类似下面这样:

    ```
    /mnt/media 192.168.79.0/24(rw,sync,wdelay,insecure,anonuid=1000,anongid=1000,all_squash)
    /mnt/backup 192.168.79.0/24(rw,sync,wdelay,insecure,anonuid=1000,anongid=1000,all_squash)

    ```

    上面这个配置开了局域网完全控制, 所以风险自负.
